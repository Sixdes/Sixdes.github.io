<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>OpenCV_python 使用 | Yao&#39;s station | Get your hands dirty.</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#9ccc65">
    
    
    <meta name="keywords" content="Image processing,OpenCV,python">
    <meta name="description" content="python-OpenCV">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenCV_python 使用">
<meta property="og:url" content="http://yaoyirong.cn/2017/12/22/OpenCV_python使用/index.html">
<meta property="og:site_name" content="Yao's station">
<meta property="og:description" content="python-OpenCV">
<meta property="og:image" content="http://yaoyirong.cn/images/OpenCV_python使用/bordered_300x300.jpg">
<meta property="og:image" content="http://yaoyirong.cn/images/OpenCV_python使用/cropped_tree.jpg">
<meta property="og:image" content="http://yaoyirong.cn/images/OpenCV_python使用/trun_green.jpg">
<meta property="og:image" content="http://yaoyirong.cn/images/OpenCV_python使用/colorless.jpg">
<meta property="og:image" content="http://yaoyirong.cn/images/OpenCV_python使用/darker.jpg">
<meta property="og:image" content="http://yaoyirong.cn/images/OpenCV_python使用/darker.jpg">
<meta property="og:image" content="http://yaoyirong.cn/images/OpenCV_python使用/img_corrected.jpg">
<meta property="og:image" content="http://yaoyirong.cn/images/OpenCV_python使用/output_14_0.png">
<meta property="og:image" content="http://yaoyirong.cn/images/OpenCV_python使用/img_pyplot截图.png">
<meta property="og:image" content="http://yaoyirong.cn/images/OpenCV_python使用/img_cv2截图.png">
<meta property="og:updated_time" content="2018-03-19T15:19:14.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OpenCV_python 使用">
<meta name="twitter:description" content="python-OpenCV">
<meta name="twitter:image" content="http://yaoyirong.cn/images/OpenCV_python使用/bordered_300x300.jpg">
    
        <link rel="alternate" type="application/atom+xml" title="Yao&#39;s station" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/background.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/logo.jpeg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Sixdes</h5>
          <a href="mailto:2521049349@qq.com" title="2521049349@qq.com" class="mail">2521049349@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/Sixdes" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about" target="_blank" >
                <i class="icon icon-lg icon-about"></i>
                About
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">OpenCV_python 使用</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">OpenCV_python 使用</h1>
        <h5 class="subtitle">
            
                <time datetime="2017-12-22T04:30:13.000Z" itemprop="datePublished" class="page-time">
  2017-12-22
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Foundation/">Foundation</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Python-OpenCV"><span class="post-toc-number">1.</span> <span class="post-toc-text">Python - OpenCV</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#OpenCV-简介"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">OpenCV 简介</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#OpenCV的结构"><span class="post-toc-number">1.1.1.</span> <span class="post-toc-text">OpenCV的结构</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#基本使用"><span class="post-toc-number">1.1.1.1.</span> <span class="post-toc-text">基本使用</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#读取图像"><span class="post-toc-number">1.1.1.1.1.</span> <span class="post-toc-text">读取图像</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#创建-复制图像"><span class="post-toc-number">1.1.1.1.2.</span> <span class="post-toc-text">创建/复制图像</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#图像元素的访问"><span class="post-toc-number">1.1.1.1.3.</span> <span class="post-toc-text">图像元素的访问</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#缩放，裁剪和补边"><span class="post-toc-number">1.1.1.1.4.</span> <span class="post-toc-text">缩放，裁剪和补边</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#色调，明暗，直方图和Gamma曲线"><span class="post-toc-number">1.1.1.1.5.</span> <span class="post-toc-text">色调，明暗，直方图和Gamma曲线</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#分离通道"><span class="post-toc-number">1.1.1.1.6.</span> <span class="post-toc-text">分离通道</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#通道合并"><span class="post-toc-number">1.1.1.1.7.</span> <span class="post-toc-text">通道合并</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Python-OpenCV基础"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">Python-OpenCV基础</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#图像的表示"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">图像的表示</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-OpenCV_python使用"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">OpenCV_python 使用</h1>
        <div class="post-meta">
            <time class="post-time" title="2017-12-22 12:30:13" datetime="2017-12-22T04:30:13.000Z"  itemprop="datePublished">2017-12-22</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Foundation/">Foundation</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>python-OpenCV</p>
<a id="more"></a>
<h1 id="Python-OpenCV"><a href="#Python-OpenCV" class="headerlink" title="Python - OpenCV"></a>Python - OpenCV</h1><p>介绍和深度学习数据处理阶段最相关的基础使用，并完成4个有趣实用的小例子：</p>
<ul>
<li>延时摄影小程序</li>
<li>视频中截屏采样的小程序</li>
<li>图片数据增加（data augmentation）的小工具</li>
<li>物体检测框标注小工具</li>
</ul>
<h2 id="OpenCV-简介"><a href="#OpenCV-简介" class="headerlink" title="OpenCV 简介"></a>OpenCV 简介</h2><p>OpenCV是计算机视觉领域应用最广泛的开源工具包，基于C/C++，支持Linux/Windows/MacOS/Android/iOS，并提供了Python，Matlab和Java等语言的接口.</p>
<h3 id="OpenCV的结构"><a href="#OpenCV的结构" class="headerlink" title="OpenCV的结构"></a>OpenCV的结构</h3><blockquote>
<p>和Python一样，当前的OpenCV也有两个大版本，OpenCV2和OpenCV3。相比OpenCV2，OpenCV3提供了更强的功能和更多方便的特性。不过考虑到和深度学习框架的兼容性，以及上手安装的难度，这部分先以2为主进行介绍。从使用的角度来看，和OpenCV2相比，OpenCV3的主要变化是更多的功能和更细化的模块划分。</p>
</blockquote>
<p>根据功能和需求的不同，OpenCV中的函数接口大体可以分为如下部分：</p>
<ul>
<li>core：核心模块，主要包含了OpenCV中最基本的结构（矩阵，点线和形状等），以及相关的基础运算/操作。</li>
<li>imgproc：图像处理模块，包含和图像相关的基础功能（滤波，梯度，改变大小等），以及一些衍生的高级功能（图像分割，直方图，形态分析和边缘/直线提取等). </li>
<li>highgui：提供了用户界面和文件读取的基本函数，比如图像显示窗口的生成和控制，图像/视频文件的IO等。</li>
</ul>
<p>如果不考虑视频应用，以上三个就是最核心和常用的模块了. </p>
<p>针对<strong>视频和一些特别的视觉应用</strong>，OpenCV也提供了强劲的支持：</p>
<ul>
<li>video：用于视频分析的常用功能，比如光流法（Optical Flow）和目标跟踪等。</li>
<li>calib3d：三维重建，立体视觉和相机标定等的相关功能。</li>
<li>features2d：二维特征相关的功能，主要是一些不受专利保护的，商业友好的特征点检测和匹配等功能，比如ORB特征。</li>
<li>object：目标检测模块，包含级联分类和Latent SVM</li>
<li>ml：机器学习算法模块，包含一些视觉中最常用的传统机器学习算法。</li>
<li>flann：最近邻算法库，Fast Library for Approximate Nearest Neighbors，用于在多维空间进行聚类和检索，经常和关键点匹配搭配使用。</li>
<li>gpu：包含了一些gpu加速的接口，底层的加速是CUDA实现。</li>
<li>photo：计算摄像学（Computational Photography）相关的接口，当然这只是个名字，其实只有图像修复和降噪而已。</li>
<li>stitching：图像拼接模块，有了它可以自己生成全景照片。</li>
<li>nonfree：受到专利保护的一些算法，其实就是SIFT和SURF。</li>
<li>contrib：一些实验性质的算法，考虑在未来版本中加入的。</li>
<li>legacy：字面是遗产，意思就是废弃的一些接口，保留是考虑到向下兼容。</li>
<li>ocl：利用OpenCL并行加速的一些接口。</li>
<li>superres：超分辨率模块，其实就是BTV-L1（Biliteral Total Variation – L1 regularization）算法</li>
<li>viz：基础的3D渲染模块，其实底层就是著名的3D工具包VTK（Visualization Toolkit）。</li>
</ul>
<h4 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h4><p>图像就是一个矩阵，在OpenCV for Python中，图像就是NumPy中的数组, 图像使用NumPy数组的属性来表示图像的尺寸和通道信息</p>
<h5 id="读取图像"><a href="#读取图像" class="headerlink" title="读取图像"></a>读取图像</h5><p>读图像用<code>cv2.imread()</code>，可以按照不同模式读取，一般最常用到的是读取单通道灰度图，或者直接默认读取多通道。存图像用<code>cv2.imwrite()</code>，注意存的时候是没有单通道这一说的, 根据保存文件名的后缀和当前的array维度，OpenCV自动判断存的通道，另外压缩格式还可以指定存储质量.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -----------------------------</span></div><div class="line"><span class="comment"># 读取图像</span></div><div class="line"><span class="comment"># -----------------------------</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> cv2</div><div class="line"></div><div class="line">img = cv2.imread(<span class="string">'little_white_dog.jpeg'</span>)</div><div class="line">cv2.namedWindow(<span class="string">'Image'</span>)</div><div class="line">cv2.imshow(<span class="string">'Image'</span>, img)</div><div class="line">cv2.waitKey(<span class="number">0</span>)</div><div class="line">cv2.destroyAllWindows()</div><div class="line">print(img.shape)</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> cv2</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line">img = cv2.imread(<span class="string">'figure.jpg'</span>)</div><div class="line">px = img[<span class="number">100</span>,<span class="number">100</span>] </div><div class="line"><span class="comment"># [128 122 153]</span></div><div class="line">print( px)  </div><div class="line">blue = img[<span class="number">100</span>,<span class="number">100</span>,<span class="number">0</span>]  </div><div class="line">print(blue)</div><div class="line"></div><div class="line"><span class="comment"># 以上这种读取像素值的方式非常缓慢。推荐使用Numpy的函数——array.item()和array.itemset()来访问</span></div><div class="line"><span class="comment"># accessing red value  </span></div><div class="line">red = img.item(<span class="number">100</span>, <span class="number">100</span>, <span class="number">2</span>)</div><div class="line">print(red)</div><div class="line"></div><div class="line"><span class="comment"># modifying RED value  </span></div><div class="line">img.itemset((<span class="number">100</span>,<span class="number">100</span>,<span class="number">2</span>), <span class="number">10</span>)</div><div class="line">img.item(<span class="number">100</span>, <span class="number">100</span>, <span class="number">2</span>)</div><div class="line"></div><div class="line"><span class="comment"># 获取图像的属性——行数、列数、通道数、图像的数据类型以及像素点的数量等</span></div><div class="line">img.shape</div><div class="line"><span class="comment"># 获得像素点的数量</span></div><div class="line">img.size</div><div class="line">img.dtype</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> cv2</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line">color_img = cv2.imread(<span class="string">'test_400x600.jpeg'</span>)</div><div class="line">print(color_img.shape)</div><div class="line"></div><div class="line"><span class="comment"># 直接读取单通道</span></div><div class="line">gray_img = cv2.imread(<span class="string">'test_400x600.jpeg'</span>, cv2.IMREAD_GRAYSCALE)</div><div class="line">print(gray_img.shape)</div><div class="line"></div><div class="line"><span class="comment"># 把单通道图片保存后，再读取，仍然是3通道，相当于把单通道值复制到3个通道保存</span></div><div class="line">cv2.imwrite(<span class="string">'test_grayscale.jpeg'</span>, gray_img)</div><div class="line">reload_grascale = cv2.imread(<span class="string">'test_grayscale.jpeg'</span>)</div><div class="line">print(reload_grascale.shape)</div><div class="line"></div><div class="line"><span class="comment"># cv2.IMWRITE_JPEG_QUALITY指定jpg质量，范围0到100，默认95，越高画质越好，文件越大</span></div><div class="line">cv2.imwrite(<span class="string">'test_imwrite.jpeg'</span>, color_img, (int(cv2.IMWRITE_JPEG_QUALITY), <span class="number">80</span>))</div><div class="line"></div><div class="line">cv2.imwrite(<span class="string">'test_imwrite.png'</span>, color_img, (int(cv2.IMWRITE_PNG_COMPRESSION), <span class="number">5</span>))</div></pre></td></tr></table></figure>
<h5 id="创建-复制图像"><a href="#创建-复制图像" class="headerlink" title="创建/复制图像"></a>创建/复制图像</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -----------------------------</span></div><div class="line"><span class="comment"># 创建/复制图像</span></div><div class="line"><span class="comment"># 图像就是一个矩阵，在OpenCV for Python中，图像就是NumPy中的数组</span></div><div class="line"><span class="comment"># 如果要创建图像，需要使用numpy的函数, 图像使用NumPy数组的属性来表示图像的尺寸和通道信息</span></div><div class="line"><span class="comment"># -----------------------------</span></div><div class="line"><span class="keyword">import</span> cv2</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line">img = cv2.imread(<span class="string">'little_white_dog.jpeg'</span>)</div><div class="line">emptyImage = np.zeros(img.shape, np.uint8)</div><div class="line"></div><div class="line">emptyImage2 = img.copy()</div><div class="line"></div><div class="line">emptyImage3 = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)</div><div class="line"><span class="comment"># emptyImage3[...] = 0</span></div><div class="line"></div><div class="line">cv2.imshow(<span class="string">'EmptyImage'</span>, emptyImage)</div><div class="line">cv2.imshow(<span class="string">'Image'</span>, img)</div><div class="line">cv2.imshow(<span class="string">'EmptyImage2'</span>, emptyImage2)</div><div class="line">cv2.imshow(<span class="string">'EmptyImage3'</span>, emptyImage3)</div><div class="line"></div><div class="line"><span class="comment"># 第三个参数针对特定的格式： 对于JPEG，其表示的是图像的质量，</span></div><div class="line"><span class="comment"># 用0-100的整数表示，默认为95。 注意，cv2.IMWRITE_JPEG_QUALITY类型为Long，必须转换成int。下面是以不同质量存储的两幅图：</span></div><div class="line"></div><div class="line">cv2.imwrite(<span class="string">'little_white_dog2.jpg'</span>, img, [int(cv2.IMWRITE_JPEG_QUALITY), <span class="number">5</span>])</div><div class="line">cv2.imwrite(<span class="string">'little_white_dog3.jpg'</span>, img, [int(cv2.IMWRITE_JPEG_QUALITY), <span class="number">100</span>])</div><div class="line"></div><div class="line"><span class="comment"># 对于PNG，第三个参数表示的是压缩级别。cv2.IMWRITE_PNG_COMPRESSION，从0到9,压缩级别越高，图像尺寸越小。默认级别为3：</span></div><div class="line"></div><div class="line">cv2.imwrite(<span class="string">'little_white_dog2.png'</span>, img, [int(cv2.IMWRITE_PNG_COMPRESSION), <span class="number">0</span>])</div><div class="line">cv2.imwrite(<span class="string">'little_white_dog3.png'</span>, img, [int(cv2.IMWRITE_PNG_COMPRESSION), <span class="number">9</span>])</div><div class="line"></div><div class="line">cv2.waitKey(<span class="number">0</span>)</div><div class="line">cv2.destroyAllWindows()</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># numpy 全复制  不是镜像</span></div><div class="line"><span class="keyword">import</span> cv2</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line">img = cv2.imread(<span class="string">'little_white_dog.jpeg'</span>)</div><div class="line">c = np.zeros(img.shape, dtype=img.dtype)</div><div class="line">c[:, :, :] = img[:, :, :]</div><div class="line">c <span class="keyword">is</span> img  <span class="comment"># false</span></div><div class="line">c.base <span class="keyword">is</span> img  <span class="comment"># false</span></div></pre></td></tr></table></figure>
<h5 id="图像元素的访问"><a href="#图像元素的访问" class="headerlink" title="图像元素的访问"></a>图像元素的访问</h5><p><strong>与C++不同，在Python中灰度图的img.ndim = 2，而C++中灰度图图像的通道数img.channel() =1</strong></p>
<p>这里使用了numpy的随机数，Python自身也有一个随机数生成函数。这里只是一种习惯，np.random模块中拥有更多的方法，而Python自带的random只是一个轻量级的模块。不过需要注意的是np.random.seed()不是线程安全的，而<strong>Python自带的random.seed()是线程安全</strong>的。如果使用随机数时需要用到多线程，建议使用Python自带的random()和random.seed()，或者构建一个本地的np.random.Random类的实例。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -----------------------------</span></div><div class="line"><span class="comment"># 图像元素的访问</span></div><div class="line"><span class="comment"># 像素的访问和访问numpy中ndarray的方法完全一样</span></div><div class="line"><span class="comment"># 下面通过对图像添加人工的椒盐现象来进一步说明OpenCV Python中需要注意的一些问题</span></div><div class="line"><span class="comment"># -----------------------------</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> cv2</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">salt</span><span class="params">(img, n)</span>:</span></div><div class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> range(n):</div><div class="line">        j = int(np.random.random() * img.shape[<span class="number">0</span>])</div><div class="line">        i = int(np.random.random() * img.shape[<span class="number">1</span>])</div><div class="line">        <span class="keyword">if</span> img.ndim == <span class="number">2</span>:</div><div class="line">            img[j, i] = <span class="number">255</span></div><div class="line">        <span class="keyword">elif</span> img.ndim ==<span class="number">3</span>:</div><div class="line">            img[j, i, <span class="number">0</span>] = <span class="number">255</span></div><div class="line">            img[j, i, <span class="number">1</span>] = <span class="number">255</span></div><div class="line">            img[j, i, <span class="number">2</span>] = <span class="number">255</span></div><div class="line">    <span class="keyword">return</span> img</div><div class="line">        </div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    img = cv2.imread(<span class="string">'iPhone.png'</span>)</div><div class="line">    saltImage = salt(img, <span class="number">500</span>)</div><div class="line">    cv2.imshow(<span class="string">'Salt'</span>, saltImage)</div><div class="line">    cv2.waitKey(<span class="number">0</span>)</div><div class="line">    cv2.destoryAllWindows()</div></pre></td></tr></table></figure>
<h5 id="缩放，裁剪和补边"><a href="#缩放，裁剪和补边" class="headerlink" title="缩放，裁剪和补边"></a>缩放，裁剪和补边</h5><p>缩放通过<code>cv2.resize()</code>实现(<strong>指定大小的格式是(宽度,高度)</strong>)，裁剪则是利用array自身的下标截取实现，此外OpenCV还可以给图像补边，这样能对一幅图像的形状和感兴趣区域实现各种操作。</p>
<p>下面的例子中读取一幅400×600分辨率的图片，并执行一些基础的操作：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment"># 读取一张600x375分辨率的图像</span></div><div class="line">img = cv2.imread(<span class="string">'figure.jpg'</span>)</div><div class="line"><span class="comment"># 缩放成200x200的方形图像</span></div><div class="line">img_200x200 = cv2.resize(img, (<span class="number">200</span>, <span class="number">200</span>))</div><div class="line"></div><div class="line"><span class="comment"># 不直接指定缩放后大小，通过fx和fy指定缩放比例，0.5则长宽都为原来一半</span></div><div class="line"><span class="comment"># 等效于img_200x300 = cv2.resize(img, (300, 200))，注意指定大小的格式是(宽度,高度)</span></div><div class="line"></div><div class="line"><span class="comment"># 插值方法默认是cv2.INTER_LINEAR，这里指定为最近邻插值</span></div><div class="line"><span class="comment"># fx、fy是沿x轴和y轴的缩放系数 和 dsize不能同时为0</span></div><div class="line"><span class="string">'''</span></div><div class="line">最优一个参数interpolation表示插值方式，有以下几种：</div><div class="line">INTER_NEAREST - 最近邻插值</div><div class="line">INTER_LINEAR - 线性插值（默认）</div><div class="line">INTER_AREA - 区域插值</div><div class="line">INTER_CUBIC - 三次样条插值</div><div class="line">INTER_LANCZOS4 - Lanczos插值</div><div class="line">'''</div><div class="line">img_200x300 = cv2.resize(img, (<span class="number">200</span>, <span class="number">300</span>), fx=<span class="number">0.5</span>, fy=<span class="number">0.5</span>, interpolation=cv2.INTER_NEAREST)</div><div class="line"></div><div class="line"><span class="comment"># 在上张图片的基础上，上下各贴50像素的黑边，生成300x300的图像</span></div><div class="line">img_300x300 = cv2.copyMakeBorder(img, <span class="number">50</span>, <span class="number">50</span>, <span class="number">0</span>, <span class="number">0</span>, cv2.BORDER_CONSTANT, value=(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>))</div><div class="line"></div><div class="line"><span class="comment"># 对照片中人脸的部分进行剪裁  高度区间和宽度区间  </span></div><div class="line"><span class="comment"># patch_tree = img[20:150, -300:-10]</span></div><div class="line">patch_tree = img[<span class="number">7</span>:<span class="number">150</span>, <span class="number">300</span>:<span class="number">450</span>]</div><div class="line"></div><div class="line">cv2.imwrite(<span class="string">'cropped_tree.jpg'</span>, patch_tree)</div><div class="line">cv2.imwrite(<span class="string">'resize_200x300.jpg'</span>, img_200x300)</div><div class="line">cv2.imwrite(<span class="string">'bordered_300x300.jpg'</span>, img_300x300)</div><div class="line">cv2.imwrite(<span class="string">'resize_200x200.jpg'</span>, img_200x200)</div></pre></td></tr></table></figure>
<p><strong>补边:</strong></p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/images/OpenCV_python使用/bordered_300x300.jpg" alt="bordered_300x300" title="">
                </div>
                <div class="image-caption">bordered_300x300</div>
            </figure>
<p><strong>裁剪:</strong></p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/images/OpenCV_python使用/cropped_tree.jpg" alt="cropped_tree" title="">
                </div>
                <div class="image-caption">cropped_tree</div>
            </figure>
<h5 id="色调，明暗，直方图和Gamma曲线"><a href="#色调，明暗，直方图和Gamma曲线" class="headerlink" title="色调，明暗，直方图和Gamma曲线"></a>色调，明暗，直方图和Gamma曲线</h5><p>除了区域，图像本身的属性操作也非常多，比如可以通过HSV空间对色调和明暗进行调节。(HSV分别是色调(Hue), 饱和度（Saturation）和明度（Value）。在HSV空间中进行调节就避免了直接在RGB空间中调节是还需要考虑三个通道的相关性. OpenCV中H的取值是[0, 180)，其他两个通道的取值都是[0, 256). </p>
<p>下面例子接着上面例子代码，通过HSV空间对图像进行调整：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> cv2</div><div class="line"></div><div class="line">img = cv2.imread(<span class="string">'figure.jpg'</span>)</div><div class="line"></div><div class="line"><span class="comment"># 通过cv2.cvtColor把图像从BGR转换到HSV</span></div><div class="line">img_hsv = cv2.cvtColor(img, cv2.COLOR_BGR2HSV)</div><div class="line"></div><div class="line">turn_green = img_hsv.copy()</div><div class="line">colorless_hsv = img_hsv.copy()</div><div class="line">darker_hsv = img_hsv.copy()</div><div class="line"></div><div class="line"><span class="comment"># H空间中，绿色比黄色的值高一点，所以给每个像素+15，黄色的树叶就会变绿</span></div><div class="line">turn_green[:, :, <span class="number">0</span>] = (turn_green[:, :, <span class="number">0</span>]+<span class="number">15</span>) % <span class="number">180</span></div><div class="line">turn_green_img = cv2.cvtColor(turn_green, cv2.COLOR_HSV2BGR)</div><div class="line">cv2.imwrite(<span class="string">'trun_green.jpg'</span>, turn_green_img)</div><div class="line"></div><div class="line"><span class="comment"># 减小饱和度会让图像损失鲜艳，变得更灰</span></div><div class="line">colorless_hsv[:, :, <span class="number">1</span>] = <span class="number">0.5</span> * colorless_hsv[:, :, <span class="number">1</span>]</div><div class="line">colorless_img = cv2.cvtColor(colorless_hsv, cv2.COLOR_HSV2BGR)</div><div class="line">cv2.imwrite(<span class="string">'colorless.jpg'</span>, colorless_img)</div><div class="line"></div><div class="line"><span class="comment"># 减小明度为原来一半</span></div><div class="line">darker_hsv[:, :, <span class="number">2</span>] = <span class="number">0.5</span> * darker_hsv[:, :, <span class="number">2</span>]</div><div class="line">darker_img = cv2.cvtColor(darker_hsv, cv2.COLOR_HSV2BGR)</div><div class="line">cv2.imwrite(<span class="string">'darker.jpg'</span>, darker_img)</div></pre></td></tr></table></figure>
<ol>
<li><p>更改色调</p>
<p><img src="/images/OpenCV_python使用/trun_green.jpg" alt="trun_green"></p>
</li>
<li><p>更改饱和度</p>
<p><img src="/images/OpenCV_python使用/colorless.jpg" alt="colorless"></p>
</li>
<li><p>更改亮度</p>
<p><img src="/images/OpenCV_python使用/darker.jpg" alt="darker"></p>
</li>
</ol>
<p><strong>直方图</strong></p>
<p>无论是HSV还是RGB，我们都较难一眼就对像素中值的分布有细致的了解，这时候就需要直方图。如果直方图中的成分过于靠近0或者255，可能就出现了<strong>暗部细节不足或者亮部细节丢失</strong>的情况。</p>
<p>这个时候，一个常用方法是考虑用Gamma变换来提升暗部细节。Gamma变换是矫正相机直接成像和人眼感受图像差别的一种常用手段，</p>
<p>简单来说就是通过非线性变换让图像从对曝光强度的线性响应变得更接近人眼感受到的响应。</p>
<p><strong>矫正前:</strong></p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/images/OpenCV_python使用/darker.jpg" alt="darker" title="">
                </div>
                <div class="image-caption">darker</div>
            </figure>
<p><strong>矫正后:</strong></p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/images/OpenCV_python使用/img_corrected.jpg" alt="img_corrected" title="">
                </div>
                <div class="image-caption">img_corrected</div>
            </figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> cv2</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> Axes3D</div><div class="line"></div><div class="line"><span class="string">'''</span></div><div class="line">cv2.calcHist(images, channels, mask, histSize, ranges[, hist[, accumulate ]]) 返回hist</div><div class="line">其中第一个参数必须用方括号括起来。</div><div class="line">第二个参数是用于计算直方图的通道</div><div class="line">第三个参数是Mask，这里没有使用，所以用None。</div><div class="line">第四个参数是histSize，表示这个直方图分成多少份（即多少个直方柱）</div><div class="line">第五个参数是表示直方图中各个像素的值, [0.0, 256.0]表示直方图能表示像素值从0.0到256的像素。</div><div class="line">最后是两个可选参数，由于直方图作为函数结果返回了，所以第六个hist就没有意义了（待确定）</div><div class="line">最后一个accumulate是一个布尔值，用来表示直方图是否叠加。</div><div class="line">'''</div><div class="line">img = cv2.imread(<span class="string">'darker.jpg'</span>)</div><div class="line"></div><div class="line"><span class="comment"># 直方图 &lt;class 'numpy.ndarray'&gt; (256, 1)</span></div><div class="line">hist_b = cv2.calcHist([img], [<span class="number">0</span>], <span class="keyword">None</span>, [<span class="number">256</span>], [<span class="number">0</span>, <span class="number">256</span>])</div><div class="line">hist_g = cv2.calcHist([img], [<span class="number">1</span>], <span class="keyword">None</span>, [<span class="number">256</span>], [<span class="number">0</span>, <span class="number">256</span>])</div><div class="line">hist_r = cv2.calcHist([img], [<span class="number">2</span>], <span class="keyword">None</span>, [<span class="number">256</span>], [<span class="number">0</span>, <span class="number">256</span>])</div><div class="line"></div><div class="line"><span class="comment"># 定义Gamma矫正的函数</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">gamma_trans</span><span class="params">(img, gamma)</span>:</span></div><div class="line">    <span class="comment"># 具体做法是先归一化到1，然后gamma作为指数值求出新的像素值再还原</span></div><div class="line">    gamma_table = [np.power(x/<span class="number">255.0</span>, gamma)*<span class="number">255.0</span> <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">256</span>)]</div><div class="line">    gamma_table = np.round(np.array(gamma_table)).astype(np.uint8)</div><div class="line">    </div><div class="line">     <span class="comment"># 实现这个映射用的是OpenCV的查找表函数</span></div><div class="line">    <span class="keyword">return</span> cv2.LUT(img, gamma_table)</div><div class="line"></div><div class="line"><span class="comment"># 执行Gamma矫正，小于1的值让暗部细节大量提升，同时亮部细节少量提升</span></div><div class="line">img_corrected = gamma_trans(img, <span class="number">0.5</span>)</div><div class="line">cv2.imwrite(<span class="string">'img_corrected.jpg'</span>,img_corrected)</div><div class="line"></div><div class="line"><span class="comment"># 分通道计算Gamma矫正后的直方图  256行一列</span></div><div class="line">hist_b_corrected = cv2.calcHist([img_corrected], [<span class="number">0</span>], <span class="keyword">None</span>, [<span class="number">256</span>], [<span class="number">0</span>, <span class="number">256</span>])</div><div class="line">hist_g_corrected = cv2.calcHist([img_corrected], [<span class="number">1</span>], <span class="keyword">None</span>, [<span class="number">256</span>], [<span class="number">0</span>, <span class="number">256</span>])</div><div class="line">hist_r_corrected = cv2.calcHist([img_corrected], [<span class="number">2</span>], <span class="keyword">None</span>, [<span class="number">256</span>], [<span class="number">0</span>, <span class="number">256</span>])</div><div class="line"></div><div class="line"><span class="comment"># 这样就会变成一行</span></div><div class="line"><span class="comment"># -------------------------------</span></div><div class="line"><span class="comment"># print(hist_b_corrected.reshape(-1))</span></div><div class="line"></div><div class="line">fig = plt.figure(figsize=(<span class="number">12</span>, <span class="number">6</span>))</div><div class="line"></div><div class="line">pix_hists = [</div><div class="line">    [hist_b.reshape(<span class="number">-1</span>), hist_g.reshape(<span class="number">-1</span>), hist_r.reshape(<span class="number">-1</span>)],</div><div class="line">    [hist_b_corrected.reshape(<span class="number">-1</span>), hist_g_corrected.reshape(<span class="number">-1</span>), hist_r_corrected.reshape(<span class="number">-1</span>)]</div><div class="line">]</div><div class="line"></div><div class="line">pix_vals = range(<span class="number">256</span>)</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">for</span> sub_plt, pix_hist <span class="keyword">in</span> zip([<span class="number">121</span>, <span class="number">122</span>], pix_hists):</div><div class="line">    ax = fig.add_subplot(sub_plt, projection=<span class="string">'3d'</span>)</div><div class="line">    <span class="keyword">for</span> c, z, channel_hist <span class="keyword">in</span> zip([<span class="string">'b'</span>, <span class="string">'g'</span>, <span class="string">'r'</span>], [<span class="number">20</span>, <span class="number">10</span>, <span class="number">0</span>], pix_hist):</div><div class="line">        cs = [c] * <span class="number">256</span></div><div class="line">        <span class="comment"># 传入的 XYZ应该是一维数组, 不能是二维, 应该是一行</span></div><div class="line">        ax.bar(pix_vals, channel_hist, zs=z, zdir=<span class="string">'y'</span>, color=cs, alpha=<span class="number">0.618</span>, edgecolor=<span class="string">'none'</span>, lw=<span class="number">0</span>)</div><div class="line"></div><div class="line">    ax.set_xlabel(<span class="string">'Pixel Values'</span>)</div><div class="line">    ax.set_xlim([<span class="number">0</span>, <span class="number">256</span>])</div><div class="line">    ax.set_ylabel(<span class="string">'Channels'</span>)</div><div class="line">    ax.set_zlabel(<span class="string">'Counts'</span>)</div><div class="line"></div><div class="line">plt.show()</div></pre></td></tr></table></figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/images/OpenCV_python使用/output_14_0.png" alt="output_14_0" title="">
                </div>
                <div class="image-caption">output_14_0</div>
            </figure>
<p>接上图 可以看到，Gamma变换后的暗部细节比起原图清楚了很多，并且从直方图来看，像素值也从集中在0附近变得散开了一些。</p>
<h5 id="分离通道"><a href="#分离通道" class="headerlink" title="分离通道"></a>分离通道</h5><p>由于OpenCV Python和NumPy结合的很紧, 所以即可以使用OpenCV自带的split函数，也可以直接操作numpy数组来分离通道。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -----------------------------</span></div><div class="line"><span class="comment"># 分离、合并通道</span></div><div class="line"><span class="comment"># 即可以使用OpenCV自带的split函数，也可以直接操作numpy数组来分离通道。</span></div><div class="line"><span class="comment"># </span></div><div class="line"><span class="comment"># -----------------------------</span></div><div class="line"><span class="keyword">import</span> cv2</div><div class="line"></div><div class="line">img = cv2.imread(<span class="string">'little_white_dog.jpeg'</span>)</div><div class="line">b, g, r = cv2.split(img)</div><div class="line">cv2.imshow(<span class="string">'Blue'</span>, b)</div><div class="line">cv2.imshow(<span class="string">'Green'</span>, g)</div><div class="line">cv2.imshow(<span class="string">'Red'</span>, r)</div><div class="line"></div><div class="line">cv2.waitKey(<span class="number">0</span>)</div><div class="line">cv2.destroyAllWindows()  </div><div class="line"></div><div class="line"><span class="comment"># split返回RGB三个通道，如果只想返回其中一个通道, 最后的索引指出所需要的通道。</span></div><div class="line">b2 = cv2.split(img)[<span class="number">0</span>]</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 也可以直接操作NumPy数组来达到这一目的：</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> cv2</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line">img = cv2.imread(<span class="string">'little_white_dog.jpeg'</span>)</div><div class="line">b = np.zeros((img.shape[<span class="number">0</span>], img.shape[<span class="number">1</span>]), dtype=img.dtype)</div><div class="line">g = np.zeros((img.shape[<span class="number">0</span>], img.shape[<span class="number">1</span>]), dtype=img.dtype)</div><div class="line">r = np.zeros((img.shape[<span class="number">0</span>], img.shape[<span class="number">1</span>]), dtype=img.dtype)</div><div class="line"></div><div class="line">b[:, :] = img[:, :, <span class="number">0</span>]</div><div class="line">g[:, :] = img[:, :, <span class="number">1</span>]</div><div class="line">r[:, :] = img[:, :, <span class="number">2</span>]</div><div class="line"></div><div class="line">cv2.imshow(<span class="string">'Blue'</span>, b)</div><div class="line">cv2.imshow(<span class="string">'green'</span>, g)</div><div class="line">cv2.imshow(<span class="string">'red'</span>, r)</div><div class="line"></div><div class="line">cv2.waitKey(<span class="number">0</span>)</div><div class="line">cv2.destoryAllWindows()</div></pre></td></tr></table></figure>
<h5 id="通道合并"><a href="#通道合并" class="headerlink" title="通道合并"></a>通道合并</h5><p><strong>????????注意：这里只是演示，实际使用时请用OpenCV自带的merge函数！用NumPy组合的结果不能在OpenCV中其他函数使用，因为其组合方式与OpenCV自带的不一样，如下：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> cv2</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line">img = cv2.imread(<span class="string">'little_white_dog.jpeg'</span>)</div><div class="line">b = np.zeros((img.shape[<span class="number">0</span>], img.shape[<span class="number">1</span>]), dtype=img.dtype)</div><div class="line">g = np.zeros((img.shape[<span class="number">0</span>], img.shape[<span class="number">1</span>]), dtype=img.dtype)</div><div class="line">r = np.zeros((img.shape[<span class="number">0</span>], img.shape[<span class="number">1</span>]), dtype=img.dtype)</div><div class="line"></div><div class="line">b[:, :] = img[:, :, <span class="number">0</span>]</div><div class="line">g[:, :] = img[:, :, <span class="number">1</span>]</div><div class="line">r[:, :] = img[:, :, <span class="number">2</span>]</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># openCV 方法 merge</span></div><div class="line">merged = cv2.merge([b, g, r])</div><div class="line">print(<span class="string">'merge by opencv'</span>)</div><div class="line"><span class="comment"># 在每个维数上以字节计算的步长</span></div><div class="line">print(merged.strides)</div><div class="line"><span class="comment"># numpy 方法  dstack</span></div><div class="line">mergedByNp = np.dstack([b, g, r])</div><div class="line">print(<span class="string">'merge by numpy'</span>)</div><div class="line">print(mergedByNp.strides)</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 关于stride</span></div><div class="line"><span class="comment"># 在每个维数上以字节计算的步长</span></div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line"><span class="comment"># a数组中每个元素都是NumPy中的整数类型，占8个字节，所以第一维中相邻元素之间的步长为8（个字节）。</span></div><div class="line">a = np.arange(<span class="number">6</span>)</div><div class="line"><span class="comment"># (8,)</span></div><div class="line">print(a.strides)</div><div class="line">print(a.dtype)  <span class="comment"># int64</span></div><div class="line"></div><div class="line"><span class="comment"># 从里面开始看，里面是一个4个元素的一维整数数组，所以步长应该为8。外面是一个含有3个元素，每个元素的长度是8×4=32。所以步长为32。</span></div><div class="line">b = np.arange(<span class="number">12</span>).reshape(<span class="number">3</span>, <span class="number">4</span>)</div><div class="line">b.strides</div><div class="line"></div><div class="line"><span class="comment"># (160, 40, 8)</span></div><div class="line">c = np.arange(<span class="number">60</span>).reshape(<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>) <span class="comment"># 三维, 行 , 列</span></div><div class="line">c.strides</div></pre></td></tr></table></figure>
<h2 id="Python-OpenCV基础"><a href="#Python-OpenCV基础" class="headerlink" title="Python-OpenCV基础"></a>Python-OpenCV基础</h2><h3 id="图像的表示"><a href="#图像的表示" class="headerlink" title="图像的表示"></a>图像的表示</h3><p>单通道的灰度图像在计算机中的表示，就是一个8位无符号整形的矩阵。</p>
<p><strong>在OpenCV中，默认的图像的表示确实反过来的，也就是BGR</strong>, 比如在Python中，图像都是用numpy的array表示，但是同样的array在OpenCV中的显示效果和matplotlib中的显示效果就会不一样。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> cv2</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line">img = np.array([</div><div class="line">    [[<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>]],</div><div class="line">    [[<span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>], [<span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>], [<span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>]],</div><div class="line">    [[<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]],</div><div class="line">], dtype=np.uint8)</div><div class="line"></div><div class="line">plt.figure(<span class="string">'matplotlib &amp; OpenCV'</span>, figsize=(<span class="number">8</span>, <span class="number">4</span>))</div><div class="line"><span class="comment"># 用matplotlib存储</span></div><div class="line">plt.imsave(<span class="string">'img_pyplot.jpg'</span>, img)</div><div class="line"></div><div class="line"><span class="comment"># 用OpenCV存储</span></div><div class="line">cv2.imwrite(<span class="string">'img_cv2.jpg'</span>, img)</div></pre></td></tr></table></figure>
<p><strong>不管是RGB还是BGR，都是高度×宽度×通道数，H×W×C的表达方式，而在深度学习中，因为要对不同通道应用卷积，所以用的是另一种方式：C×H×W，就是把每个通道都单独表达成一个二维矩阵.</strong><br>np.reshape() 😂 好像就是 CHW (不知道能否这么表述)</p>
<p><strong>像素点太小了, 截图展示</strong></p>
<p><strong>用matplotlib存储:</strong>                                                                          <strong>用OpenCV存储:</strong></p>
<p><img src="/images/OpenCV_python使用/img_pyplot截图.png" alt="img_pyplot截图">         <img src="/images/OpenCV_python使用/img_cv2截图.png" alt="img_cv2截图"></p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2018-03-19T15:19:14.000Z" itemprop="dateUpdated">2018-03-19 23:19:14</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/2017/12/22/OpenCV_python使用/" target="_blank" rel="external">http://yaoyirong.cn/2017/12/22/OpenCV_python使用/</a>
        
    </div>
    
    <footer>
        <a href="http://yaoyirong.cn">
            <img src="/img/logo.jpeg" alt="Sixdes">
            Sixdes
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Image-processing/">Image processing</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenCV/">OpenCV</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://yaoyirong.cn/2017/12/22/OpenCV_python使用/&title=《OpenCV_python 使用》 — Yao's station&pic=http://yaoyirong.cn/img/logo.jpeg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://yaoyirong.cn/2017/12/22/OpenCV_python使用/&title=《OpenCV_python 使用》 — Yao's station&source=python-OpenCV" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://yaoyirong.cn/2017/12/22/OpenCV_python使用/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《OpenCV_python 使用》 — Yao's station&url=http://yaoyirong.cn/2017/12/22/OpenCV_python使用/&via=http://yaoyirong.cn" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://yaoyirong.cn/2017/12/22/OpenCV_python使用/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2017/12/26/图像特征提取实例/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Image Feature extraction example</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2017/12/22/matplotlib使用/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">matplotlib 使用</h4>
      </a>
    </div>
  
</nav>



    














</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.png" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.png" data-alipay="/img/alipay.png">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Sixdes &copy; 2015 - 2018</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://yaoyirong.cn/2017/12/22/OpenCV_python使用/&title=《OpenCV_python 使用》 — Yao's station&pic=http://yaoyirong.cn/img/logo.jpeg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://yaoyirong.cn/2017/12/22/OpenCV_python使用/&title=《OpenCV_python 使用》 — Yao's station&source=python-OpenCV" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://yaoyirong.cn/2017/12/22/OpenCV_python使用/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《OpenCV_python 使用》 — Yao's station&url=http://yaoyirong.cn/2017/12/22/OpenCV_python使用/&via=http://yaoyirong.cn" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://yaoyirong.cn/2017/12/22/OpenCV_python使用/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://yaoyirong.cn/2017/12/22/OpenCV_python使用/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
